## Introduction
This lab will go through some basic on how to do memory forensic and malware reverse engineering.

## Volatility lab 01 - Redline(CyberDefender)
In this lab we will be using lab from cyberdefender you can download the lab from the following link -> https://cyberdefenders.org/blueteam-ctf-challenges/redline/.
You need to register to the platform in order to able to download the sample file. Once you get the .zip file you can unzip it and enter the password, like this:

```
~# unzip 106-RedLine.zip 
Archive:  106-RedLine.zip
[106-RedLine.zip] temp_extract_dir/MemoryDump.mem password: 
  inflating: temp_extract_dir/MemoryDump.mem  
                                             
```
We can test volatility to check which Windows OS does this memory dump come from:
```
~# python3 vol.py -f ~/Desktop/temp_extract_dir/MemoryDump.mem windows.info 
Volatility 3 Framework 2.26.0
Progress:    0.10               Reading file http://msdl.microsoft.com/download/....
```
When you run the program first time it will automatically download the neccessary PDB to be used to parse all related information to interact with of the OS inside the dump. If its done it will show you the following result:
```
Variable        Value

Kernel Base     0xf8076221a000
DTB     0x1ad000
Symbols file:///home/kali/Documents/volatility/volatility3-2.26.0/volatility3/symbols/windows/ntkrnlmp.pdb/68A17FAF3012B7846079AEECDBE0A583-1.json.xz
Is64Bit True
IsPAE   False
layer_name      0 WindowsIntel32e
memory_layer    1 FileLayer
KdVersionBlock  0xf80762e29398
Major/Minor     15.19041
MachineType     34404
KeNumberProcessors      4
SystemTime      2023-05-21 23:02:39+00:00
NtSystemRoot    C:\Windows
NtProductType   NtProductWinNt
NtMajorVersion  10
NtMinorVersion  0
PE MajorOperatingSystemVersion  10
PE MinorOperatingSystemVersion  0
PE Machine      34404
PE TimeDateStamp        Wed Jun 28 04:14:26 1995
```
I'm not gonna answer the question that showed in cyberdefenders dashboard because there is plenty excellence write up out there, but I will explain certain question that you should answer first when you work as a forensic investigator or incident responder.

1. The first or the most obvious will be where is the malware?

The most straightforward will be using the windows.malfind plugin from volatility, like this:
```
~# python3 vol.py -f ~/Desktop/temp_extract_dir/MemoryDump.mem  windows.malfind
Volatility 3 Framework 2.5.0
Progress:  100.00               PDB scanning finished                        
PID     Process Start VPN       End VPN Tag     Protection      CommitCharge    PrivateMemory   File output     Hexdump Disasm

5896    oneetx.exe      0x400000        0x437fff        VadS    PAGE_EXECUTE_READWRITE  56      1       Disabled
4d 5a 90 00 03 00 00 00 MZ......
04 00 00 00 ff ff 00 00 ........
b8 00 00 00 00 00 00 00 ........
40 00 00 00 00 00 00 00 @.......
00 00 00 00 00 00 00 00 ........
00 00 00 00 00 00 00 00 ........
00 00 00 00 00 00 00 00 ........
00 00 00 00 00 01 00 00 ........


7540    smartscreen.ex  0x2505c140000   0x2505c15ffff   VadS    PAGE_EXECUTE_READWRITE  1       1       Disabled
48 89 54 24 10 48 89 4c H.T$.H.L
24 08 4c 89 44 24 18 4c $.L.D$.L
89 4c 24 20 48 8b 41 28 .L$.H.A(
48 8b 48 08 48 8b 51 50 H.H.H.QP
48 83 e2 f8 48 8b ca 48 H...H..H
b8 60 00 14 5c 50 02 00 .`..\P..
00 48 2b c8 48 81 f9 70 .H+.H..p
0f 00 00 76 09 48 c7 c1 ...v.H..
0x2505c140000:  mov     qword ptr [rsp + 0x10], rdx
0x2505c140005:  mov     qword ptr [rsp + 8], rcx
0x2505c14000a:  mov     qword ptr [rsp + 0x18], r8
0x2505c14000f:  mov     qword ptr [rsp + 0x20], r9
0x2505c140014:  mov     rax, qword ptr [rcx + 0x28]
0x2505c140018:  mov     rcx, qword ptr [rax + 8]
0x2505c14001c:  mov     rdx, qword ptr [rcx + 0x50]
0x2505c140020:  and     rdx, 0xfffffffffffffff8
0x2505c140024:  mov     rcx, rdx
0x2505c140027:  movabs  rax, 0x2505c140060
0x2505c140031:  sub     rcx, rax
0x2505c140034:  cmp     rcx, 0xf70
0x2505c14003b:  jbe     0x2505c140046
```
Windows.malfind plugin will be search inside the entire the memory dump to find any signature that matched with its malware database and as you can see we got two matches which are the first the malware itself, while the second is smartscreen.exe file and if you try to investigate what is that program.

You will end up windows defender page, so basically SmartScreen is a cloud-based anti-phishing/anti-malware component which is included in different Microsoft products such as: Windows, Internet Explorer and Microsoft Edge. But why is it marked as malware by the plugin?

My answer is that this could be view as the disadvantages of detecting malware through signature. To emphasize this statement, I would like to ask you guys a very simple question, can you tell the difference between a Teamviewer and Remote Access Trojan?

You might tempted to answer one is malware and one is not, if you answer that you're missing the nature of the question. How can you tell if one is malicious and one is not? if i remove the name both of the program can you guess which one is which?

If you try to reverse engineer it you might end up in the same conclusion both of the program may have the same functionality and both of them allow to do remote connection.

To actually measured if a program is malicious we have to know the "intention" of the program. But solely rely on code signature would not cut it and it could lead to false positive which is what we are experiencing right now.

My point is never rely on one approach always double check with multiple approaches, it might give more perspective on the "intention" of the program. 

Is there any alternative beside using windows.malfind plugin? Well we can used windows.pstree plugin that will list all of process of OS like this:

```
~# python3 vol.py -f ~/Desktop/temp_extract_dir/MemoryDump.mem windows.pstree
Volatility 3 Framework 2.5.0
Progress:  100.00               PDB scanning finished                        
PID     PPID    ImageFileName   Offset(V)       Threads Handles SessionId       Wow64   CreateTime      ExitTime

4       0       System  0xad8185883180  157     -       N/A     False   2023-05-21 22:27:10.000000      N/A
* 1280  4       MemCompression  0xad8187835080  62      -       N/A     False   2023-05-21 22:27:49.000000      N/A
* 108   4       Registry        0xad81858f2080  4       -       N/A     False   2023-05-21 22:26:54.000000      N/A
* 332   4       smss.exe        0xad81860dc040  2       -       N/A     False   2023-05-21 22:27:10.000000      N/A
452     444     csrss.exe       0xad81861cd080  12      -       0       False   2023-05-21 22:27:22.000000      N/A
528     520     csrss.exe       0xad8186f1b140  14      -       1       False   2023-05-21 22:27:25.000000      N/A
552     444     wininit.exe     0xad8186f2b080  1       -       0       False   2023-05-21 22:27:25.000000      N/A
* 696   552     lsass.exe       0xad8186fc6080  10      -       0       False   2023-05-21 22:27:29.000000      N/A
* 676   552     services.exe    0xad8186f4d080  7       -       0       False   2023-05-21 22:27:29.000000      N/A
** 4228 676     SearchIndexer.  0xad818ce06240  15      -       0       False   2023-05-21 22:31:27.000000      N/A
** 8708 676     svchost.exe     0xad818d431080  5       -       0       False   2023-05-21 22:57:33.000000      N/A
** 5136 676     SecurityHealth  0xad818d374280  7       -       0       False   2023-05-21 22:32:01.000000      N/A
** 2200 676     VGAuthService.  0xad81896b3300  2       -       0       False   2023-05-21 22:28:19.000000      N/A
** 3608 676     svchost.exe     0xad818d07a080  3       -       0       False   2023-05-21 22:41:28.000000      N/A
** 2076 676     svchost.exe     0xad8187b94080  10      -       0       False   2023-05-21 22:28:19.000000      N/A
** 1448 676     svchost.exe     0xad818796c2c0  30      -       0       False   2023-05-21 22:27:52.000000      N/A
** 1064 676     svchost.exe     0xad8189d7c2c0  15      -       1       False   2023-05-21 22:30:09.000000      N/A
** 6696 676     svchost.exe     0xad818c532080  8       -       0       False   2023-05-21 22:34:07.000000      N/A
** 1196 676     svchost.exe     0xad81877972c0  34      -       0       False   2023-05-21 22:27:46.000000      N/A
** 1840 676     spoolsv.exe     0xad8187acb200  10      -       0       False   2023-05-21 22:28:03.000000      N/A
** 952  676     svchost.exe     0xad81876802c0  12      -       0       False   2023-05-21 22:27:36.000000      N/A
** 824  676     svchost.exe     0xad818761d240  22      -       0       False   2023-05-21 22:27:32.000000      N/A
*** 7312        824     ApplicationFra  0xad818e84f300  10      -       1       False   2023-05-21 22:35:44.000000      N/A
*** 4116        824     RuntimeBroker.  0xad818cd93300  3       -       1       False   2023-05-21 22:31:24.000000      N/A
*** 5656        824     RuntimeBroker.  0xad81876e8080  0       -       1       False   2023-05-21 21:58:19.000000      2023-05-21 22:02:01.000000 
*** 2332        824     TiWorker.exe    0xad818e780080  4       -       0       False   2023-05-21 22:58:13.000000      N/A
*** 7336        824     RuntimeBroker.  0xad818e8bb080  2       -       1       False   2023-05-21 22:11:39.000000      N/A
*** 5808        824     HxTsr.exe       0xad818de5d080  0       -       1       False   2023-05-21 21:59:58.000000      2023-05-21 22:07:45.000000 
*** 7160        824     SearchApp.exe   0xad818ccc4080  57      -       1       False   2023-05-21 22:39:13.000000      N/A
*** 6076        824     ShellExperienc  0xad818eb18080  14      -       1       False   2023-05-21 22:11:36.000000      N/A
*** 5704        824     RuntimeBroker.  0xad8185962080  5       -       1       False   2023-05-21 22:32:44.000000      N/A
*** 8264        824     RuntimeBroker.  0xad818eec8080  4       -       1       False   2023-05-21 22:40:33.000000      N/A
*** 3160        824     StartMenuExper  0xad818cad3240  14      -       1       False   2023-05-21 22:31:21.000000      N/A
*** 4448        824     RuntimeBroker.  0xad818c09a080  9       -       1       False   2023-05-21 22:31:33.000000      N/A
*** 1764        824     dllhost.exe     0xad818d176080  7       -       1       False   2023-05-21 22:32:48.000000      N/A
*** 3944        824     WmiPrvSE.exe    0xad818c054080  13      -       0       False   2023-05-21 22:30:44.000000      N/A
*** 6644        824     SkypeApp.exe    0xad818d3ac080  49      -       1       False   2023-05-21 22:41:52.000000      N/A
*** 372 824     SkypeBackgroun  0xad8186f49080  3       -       1       False   2023-05-21 22:10:00.000000      N/A
*** 7540        824     smartscreen.ex  0xad818e893080  14      -       1       False   2023-05-21 23:02:26.000000      N/A
*** 8952        824     TextInputHost.  0xad818e6db080  10      -       1       False   2023-05-21 21:59:11.000000      N/A
*** 1916        824     SearchApp.exe   0xad818d099080  24      -       1       False   2023-05-21 22:33:05.000000      N/A
** 6200 676     SgrmBroker.exe  0xad818d09f080  7       -       0       False   2023-05-21 22:33:42.000000      N/A
** 3004 676     svchost.exe     0xad818c4212c0  7       -       0       False   2023-05-21 22:30:55.000000      N/A
** 448  676     svchost.exe     0xad8187721240  54      -       0       False   2023-05-21 22:27:41.000000      N/A
*** 1600        448     taskhostw.exe   0xad8189d07300  10      -       1       False   2023-05-21 22:30:09.000000      N/A
*** 6048        448     taskhostw.exe   0xad818dc5d080  5       -       1       False   2023-05-21 22:40:20.000000      N/A
*** 3876        448     taskhostw.exe   0xad8189b30080  8       -       1       False   2023-05-21 22:08:02.000000      N/A
*** 5480        448     oneetx.exe      0xad818d3d6080  6       -       1       True    2023-05-21 23:03:00.000000      N/A
*** 1392        448     sihost.exe      0xad8189e94280  11      -       1       False   2023-05-21 22:30:08.000000      N/A
** 832  676     msdtc.exe       0xad8185861280  9       -       0       False   2023-05-21 22:29:25.000000      N/A
** 6596 676     TrustedInstall  0xad818dc88080  4       -       0       False   2023-05-21 22:58:13.000000      N/A
** 5964 676     svchost.exe     0xad818ef86080  5       -       0       False   2023-05-21 22:27:56.000000      N/A
** 1232 676     svchost.exe     0xad8186f4a2c0  7       -       0       False   2023-05-21 22:29:39.000000      N/A
** 3028 676     dllhost.exe     0xad8185907080  12      -       0       False   2023-05-21 22:29:20.000000      N/A
** 1496 676     svchost.exe     0xad81879752c0  12      -       0       False   2023-05-21 22:27:52.000000      N/A
*** 6324        1496    audiodg.exe     0xad818df2e080  4       -       0       False   2023-05-21 22:42:56.000000      N/A
** 1116 676     svchost.exe     0xad818c426080  6       -       1       False   2023-05-21 22:31:00.000000      N/A
** 7772 676     svchost.exe     0xad818e88e140  3       -       0       False   2023-05-21 22:36:03.000000      N/A
** 1376 676     svchost.exe     0xad81878020c0  15      -       0       False   2023-05-21 22:27:49.000000      N/A
** 2144 676     vmtoolsd.exe    0xad81896ab080  11      -       0       False   2023-05-21 22:28:19.000000      N/A
** 1120 676     MsMpEng.exe     0xad818945c080  12      -       0       False   2023-05-21 22:10:01.000000      N/A
** 1892 676     svchost.exe     0xad8187b34080  14      -       0       False   2023-05-21 22:28:05.000000      N/A
** 5476 676     svchost.exe     0xad818e752080  9       -       0       False   2023-05-21 22:58:08.000000      N/A
** 2024 676     svchost.exe     0xad8187b65240  7       -       0       False   2023-05-21 22:28:11.000000      N/A
** 2152 676     vm3dservice.ex  0xad81896ae240  2       -       0       False   2023-05-21 22:28:19.000000      N/A
*** 2404        2152    vm3dservice.ex  0xad8186619200  2       -       1       False   2023-05-21 22:28:32.000000      N/A
** 1644 676     svchost.exe     0xad8187a112c0  6       -       0       False   2023-05-21 22:27:58.000000      N/A
** 752  676     svchost.exe     0xad8187758280  21      -       0       False   2023-05-21 22:27:43.000000      N/A
*** 3204        752     ctfmon.exe      0xad8189c8b280  12      -       1       False   2023-05-21 22:30:11.000000      N/A
** 1012 676     svchost.exe     0xad818774c080  19      -       0       False   2023-05-21 22:27:43.000000      N/A
** 1652 676     svchost.exe     0xad8187a2d2c0  10      -       0       False   2023-05-21 22:27:58.000000      N/A
** 4340 676     VSSVC.exe       0xad818e888080  3       -       0       False   2023-05-21 23:01:06.000000      N/A
** 2044 676     svchost.exe     0xad8189b27080  28      -       0       False   2023-05-21 22:49:29.000000      N/A
* 852   552     fontdrvhost.ex  0xad818761b0c0  5       -       0       False   2023-05-21 22:27:33.000000      N/A
588     520     winlogon.exe    0xad8186f450c0  5       -       1       False   2023-05-21 22:27:25.000000      N/A
* 1016  588     dwm.exe 0xad81876e4340  15      -       1       False   2023-05-21 22:27:38.000000      N/A
* 3556  588     userinit.exe    0xad818c02f340  0       -       1       False   2023-05-21 22:30:28.000000      2023-05-21 22:30:43.000000 
** 3580 3556    explorer.exe    0xad818c047340  76      -       1       False   2023-05-21 22:30:28.000000      N/A
*** 6724        3580    Outline.exe     0xad818e578080  0       -       1       True    2023-05-21 22:36:09.000000      2023-05-21 23:01:24.000000 
**** 4224       6724    Outline.exe     0xad818e88b080  0       -       1       True    2023-05-21 22:36:23.000000      2023-05-21 23:01:24.000000 
**** 4628       6724    tun2socks.exe   0xad818de82340  0       -       1       True    2023-05-21 22:40:10.000000      2023-05-21 23:01:24.000000 
*** 5636        3580    notepad.exe     0xad818db45080  1       -       1       False   2023-05-21 22:46:50.000000      N/A
*** 464 3580    SecurityHealth  0xad818979d080  3       -       1       False   2023-05-21 22:31:59.000000      N/A
*** 5328        3580    msedge.exe      0xad818d0980c0  54      -       1       False   2023-05-21 22:32:02.000000      N/A
**** 4544       5328    msedge.exe      0xad818d75b080  14      -       1       False   2023-05-21 22:32:39.000000      N/A
**** 8896       5328    msedge.exe      0xad8187a39080  18      -       1       False   2023-05-21 22:28:21.000000      N/A
**** 5156       5328    msedge.exe      0xad818c553080  14      -       1       False   2023-05-21 22:28:22.000000      N/A
**** 7964       5328    msedge.exe      0xad818dee5080  19      -       1       False   2023-05-21 22:22:09.000000      N/A
**** 4396       5328    msedge.exe      0xad818d515080  7       -       1       False   2023-05-21 22:32:19.000000      N/A
**** 6544       5328    msedge.exe      0xad818c0ea080  18      -       1       False   2023-05-21 22:22:35.000000      N/A
**** 2388       5328    msedge.exe      0xad818e54c340  18      -       1       False   2023-05-21 22:05:35.000000      N/A
**** 6292       5328    msedge.exe      0xad818d7a1080  20      -       1       False   2023-05-21 22:06:15.000000      N/A
**** 1144       5328    msedge.exe      0xad818d75f080  18      -       1       False   2023-05-21 22:32:38.000000      N/A
**** 5340       5328    msedge.exe      0xad818d7b3080  10      -       1       False   2023-05-21 22:32:39.000000      N/A
*** 3252        3580    vmtoolsd.exe    0xad8189796300  8       -       1       False   2023-05-21 22:31:59.000000      N/A
*** 2228        3580    FTK Imager.exe  0xad818d143080  10      -       1       False   2023-05-21 22:43:56.000000      N/A
*** 8920        3580    FTK Imager.exe  0xad818ef81080  20      -       1       False   2023-05-21 23:02:28.000000      N/A
* 860   588     fontdrvhost.ex  0xad818761f140  5       -       1       False   2023-05-21 22:27:33.000000      N/A
5896    8844    oneetx.exe      0xad8189b41080  5       -       1       True    2023-05-21 22:30:56.000000      N/A
* 7732  5896    rundll32.exe    0xad818d1912c0  1       -       1       True    2023-05-21 22:31:53.000000      N/A
```
As you can see the malware spawn rundll32.exe, is it consider malicious to run this .dll? no, because this is just a standard .dll provide by windows but we can marked this as suspicious activity since if you try to compare with the rest of the program no one actually run the rundll32 program.

2. Next question will be is the malware connect to an C&C server?

To answer that we can used windows.netscan plugin like this:

```
~# python3 vol.py -f ~/Desktop/temp_extract_dir/MemoryDump.mem windows.netscan | grep -i "oneetx.exe"
0xad818de4aa20.0TCPv4   10.0.85.2DB scan55462fin77.91.124.20    80      CLOSED  5896    oneetx.exe      2023-05-21 23:01:22.000000 
0xad818e4a6900  UDPv4   0.0.0.0 0       *       0               5480    oneetx.exe      2023-05-21 22:39:47.000000 
0xad818e4a6900  UDPv6   ::      0       *       0               5480    oneetx.exe      2023-05-21 22:39:47.000000 
0xad818e4a9650  UDPv4   0.0.0.0 0       *       0               5480    oneetx.exe      2023-05-21 22:39:47.000000 
```
The plugin will help you to dump all the live connection that happen when live forensic happen and we can see that the malware indeed connect to a endpoint that we can assume as C&C server.

3. How the program is run?

Sometimes we need to know how the malware run, is the malware program have an extra parameter that could get us some clue? this can be done using windows.cmdline plugin like this:
```
python3 vol.py -f ~/Desktop/temp_extract_dir/MemoryDump.mem windows.cmdline
Volatility 3 Framework 2.26.0
Progress:  100.00               PDB scanning finished                        
PID     Process Args

4       System  -
108     Registry        -
332     smss.exe        -
452     csrss.exe       -
528     csrss.exe       -
552     wininit.exe     -
588     winlogon.exe    -
676     services.exe    C:\Windows\system32\services.exe
696     lsass.exe       C:\Windows\system32\lsass.exe
824     svchost.exe     C:\Windows\system32\svchost.exe -k DcomLaunch -p
852     fontdrvhost.ex  -
860     fontdrvhost.ex  -
952     svchost.exe     C:\Windows\system32\svchost.exe -k RPCSS -p
1016    dwm.exe "dwm.exe"
448     svchost.exe     C:\Windows\system32\svchost.exe -k netsvcs -p
752     svchost.exe     C:\Windows\System32\svchost.exe -k LocalSystemNetworkRestricted -p
1012    svchost.exe     C:\Windows\System32\svchost.exe -k LocalServiceNetworkRestricted -p
1196    svchost.exe     C:\Windows\system32\svchost.exe -k LocalService -p
1280    MemCompression  -
1376    svchost.exe     C:\Windows\system32\svchost.exe -k LocalServiceNoNetwork -p
1448    svchost.exe     C:\Windows\System32\svchost.exe -k NetworkService -p
1496    svchost.exe     C:\Windows\System32\svchost.exe -k LocalServiceNetworkRestricted -p
1644    svchost.exe     -
1652    svchost.exe     C:\Windows\system32\svchost.exe -k LocalServiceNetworkRestricted -p
1840    spoolsv.exe     -
1892    svchost.exe     C:\Windows\system32\svchost.exe -k LocalServiceNoNetworkFirewall -p
2024    svchost.exe     -
2076    svchost.exe     C:\Windows\System32\svchost.exe -k utcsvc -p
2144    vmtoolsd.exe    "C:\Program Files\VMware\VMware Tools\vmtoolsd.exe"
2152    vm3dservice.ex  -
2200    VGAuthService.  -
2404    vm3dservice.ex  -
3028    dllhost.exe     C:\Windows\system32\dllhost.exe /Processid:{02D4B3F1-FD88-11D1-960D-00805FC79235}
832     msdtc.exe       -
1232    svchost.exe     -
1392    sihost.exe      sihost.exe
1064    svchost.exe     C:\Windows\system32\svchost.exe -k UnistackSvcGroup
1600    taskhostw.exe   -
3204    ctfmon.exe      "ctfmon.exe"
3556    userinit.exe    -
3580    explorer.exe    C:\Windows\Explorer.EXE
3944    WmiPrvSE.exe    C:\Windows\system32\wbem\wmiprvse.exe
3004    svchost.exe     C:\Windows\system32\svchost.exe -k LocalServiceAndNoImpersonation -p
1116    svchost.exe     C:\Windows\system32\svchost.exe -k ClipboardSvcGroup -p
3160    StartMenuExper  "C:\Windows\SystemApps\Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy\StartMenuExperienceHost.exe" -ServerName:App.AppXywbrabmsek0gm3tkwpr5kwzbs55tkqay.mca
4116    RuntimeBroker.  -
4228    SearchIndexer.  C:\Windows\system32\SearchIndexer.exe /Embedding
4448    RuntimeBroker.  C:\Windows\System32\RuntimeBroker.exe -Embedding
464     SecurityHealth  -
3252    vmtoolsd.exe    "C:\Program Files\VMware\VMware Tools\vmtoolsd.exe" -n vmusr
5136    SecurityHealth  -
5328    msedge.exe      "C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe" --no-startup-window --win-session-start /prefetch:5
4396    msedge.exe      -
1144    msedge.exe      -
4544    msedge.exe      -
5340    msedge.exe      -
5704    RuntimeBroker.  C:\Windows\System32\RuntimeBroker.exe -Embedding
1764    dllhost.exe     -
1916    SearchApp.exe   -
6200    SgrmBroker.exe  -
6696    svchost.exe     -
7312    ApplicationFra  C:\Windows\system32\ApplicationFrameHost.exe -Embedding
7772    svchost.exe     -
6724    Outline.exe     -
4224    Outline.exe     -
7160    SearchApp.exe   -
4628    tun2socks.exe   -
6048    taskhostw.exe   -
8264    RuntimeBroker.  -
3608    svchost.exe     -
6644    SkypeApp.exe    -
5656    RuntimeBroker.  -
8952    TextInputHost.  "C:\Windows\SystemApps\MicrosoftWindows.Client.CBS_cw5n1h2txyewy\TextInputHost.exe" -ServerName:InputApp.AppXjd5de1g66v206tj52m9d0dtpppx4cgpn.mca
5808    HxTsr.exe       -
2388    msedge.exe      -
6292    msedge.exe      -
3876    taskhostw.exe   -
372     SkypeBackgroun  -
1120    MsMpEng.exe     -
6076    ShellExperienc  -
7336    RuntimeBroker.  -
7964    msedge.exe      -
6544    msedge.exe      -
5964    svchost.exe     -
8896    msedge.exe      -
5156    msedge.exe      -
5896    oneetx.exe      -
7732    rundll32.exe    -
6324    audiodg.exe     -
2228    FTK Imager.exe  -
5636    notepad.exe     -
2044    svchost.exe     C:\Windows\system32\svchost.exe -k wsappx -p
8708    svchost.exe     -
5476    svchost.exe     C:\Windows\System32\svchost.exe -k NetworkService -p
6596    TrustedInstall  -
2332    TiWorker.exe    -
4340    VSSVC.exe       C:\Windows\system32\vssvc.exe
7540    smartscreen.ex  C:\Windows\System32\smartscreen.exe -Embedding
8920    FTK Imager.exe  "C:\Program Files\AccessData\FTK Imager\FTK Imager.exe" 
5480    oneetx.exe      -
```
As we can see oneetx doesn't come with extra parameter but thats okay and its something that its relative.

4. How can I dump the real program to my PC so I can reverse engineer it?

You can used windows.dumpfile plugin, like this:
```
~# python3 vol.py -f ~/Desktop/temp_extract_dir/MemoryDump.mem windows.dumpfile --pid 5896
Volatility 3 Framework 2.26.0
Progress:  100.00               PDB scanning finished                        
Cache   FileObject      FileName        Result

ImageSectionObject      0xad818e37b8e0  AcLayers.dll    file.0xad818e37b8e0.0xad818ea09d00.ImageSectionObject.AcLayers.dll.img
ImageSectionObject      0xad818da36c30  oneetx.exe      file.0xad818da36c30.0xad818ca48660.ImageSectionObject.oneetx.exe.img
ImageSectionObject      0xad818e48a450  sfc.dll Error dumping file
DataSectionObject       0xad81876b7860  R000000000006.clb       Error dumping file
DataSectionObject       0xad8187a70b60  cversions.2.db  file.0xad8187a70b60.0xad8187ba3070.DataSectionObject.cversions.2.db.dat
ImageSectionObject      0xad8189ce9740  profapi.dll     file.0xad8189ce9740.0xad818c027ba0.ImageSectionObject.profapi.dll.img
ImageSectionObject      0xad818d44ca70  IPHLPAPI.DLL    file.0xad818d44ca70.0xad818d33fcd0.ImageSectionObject.IPHLPAPI.DLL.img
ImageSectionObject      0xad818f88a770  OnDemandConnRouteHelper.dll     file.0xad818f88a770.0xad818e0c8d30.ImageSectionObject.OnDemandConnRouteHelper.dll.img
ImageSectionObject      0xad818c3c0a90  winhttp.dll     file.0xad818c3c0a90.0xad818ce43a20.ImageSectionObject.winhttp.dll.img
ImageSectionObject      0xad818d43cee0  HarddiskVolume31.1.mum  Error dumping file
ImageSectionObject      0xad818ef21130  edputil.dll     Error dumping file
ImageSectionObject      0xad818e4849b0  srvcli.dll      Error dumping file
ImageSectionObject      0xad818ef239d0  netutils.dll    Error dumping file
ImageSectionObject      0xad818e384bc0  mpr.dll Error dumping file
ImageSectionObject      0xad81861b3ce0  msvcrt.dll      file.0xad81861b3ce0.0xad81863d0d60.ImageSectionObject.msvcrt.dll.img
ImageSectionObject      0xad81898a1150  HarddiskVolume3㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀 file.0xad81898a1150.0xad8189706730.ImageSectionObject.HarddiskVolume3㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀㙎倀.img
ImageSectionObject      0xad818d43f780  uxtheme.dll     file.0xad818d43f780.0xad818cf17a20.ImageSectionObject.uxtheme.dll.img
ImageSectionObject      0xad81861b20c0  msvcp_win.dll   file.0xad81861b20c0.0xad818618f010.ImageSectionObject.msvcp_win.dll.img
ImageSectionObject      0xad81861b39c0  bcryptprimitives.dll    file.0xad81861b39c0.0xad81863d1d60.ImageSectionObject.bcryptprimitives.dll.img
ImageSectionObject      0xad81861b36a0  nsi.dll file.0xad81861b36a0.0xad81863d2d60.ImageSectionObject.nsi.dll.img
ImageSectionObject      0xad81861b3380  clbcatq.dll     file.0xad81861b3380.0xad818618e270.ImageSectionObject.clbcatq.dll.img
ImageSectionObject      0xad81861b3830  advapi32.dll    file.0xad81861b3830.0xad818618e010.ImageSectionObject.advapi32.dll.img
ImageSectionObject      0xad81861a8570  ws2_32.dll      file.0xad81861a8570.0xad818618dc30.ImageSectionObject.ws2_32.dll.img
ImageSectionObject      0xad81861a9510  user32.dll      file.0xad81861a9510.0xad81861917b0.ImageSectionObject.user32.dll.img
ImageSectionObject      0xad81861a99c0  shlwapi.dll     file.0xad81861a99c0.0xad8186195750.ImageSectionObject.shlwapi.dll.img
ImageSectionObject      0xad81861a9b50  KernelBase.dll  file.0xad81861a9b50.0xad818618d010.ImageSectionObject.KernelBase.dll.img
ImageSectionObject      0xad81861a8ed0  setupapi.dll    Error dumping file
ImageSectionObject      0xad81861a9e70  sechost.dll     file.0xad81861a9e70.0xad8186195c10.ImageSectionObject.sechost.dll.img
ImageSectionObject      0xad81861a96a0  gdi32full.dll   file.0xad81861a96a0.0xad8186191c70.ImageSectionObject.gdi32full.dll.img
ImageSectionObject      0xad81861a91f0  ucrtbase.dll    file.0xad81861a91f0.0xad81863d4d60.ImageSectionObject.ucrtbase.dll.img
ImageSectionObject      0xad81861a8700  imm32.dll       file.0xad81861a8700.0xad8186191a10.ImageSectionObject.imm32.dll.img
ImageSectionObject      0xad81863b6250  win32u.dll      file.0xad81863b6250.0xad81863d6d60.ImageSectionObject.win32u.dll.img
ImageSectionObject      0xad81861a9ce0  combase.dll     file.0xad81861a9ce0.0xad8186191050.ImageSectionObject.combase.dll.img
ImageSectionObject      0xad81861a9380  cfgmgr32.dll    file.0xad81861a9380.0xad8186191550.ImageSectionObject.cfgmgr32.dll.img
ImageSectionObject      0xad81863b6890  bcrypt.dll      file.0xad81863b6890.0xad8186128be0.ImageSectionObject.bcrypt.dll.img
ImageSectionObject      0xad8186134250  wow64cpu.dll    file.0xad8186134250.0xad818618a720.ImageSectionObject.wow64cpu.dll.img
ImageSectionObject      0xad81863b7b50  rpcrt4.dll      file.0xad81863b7b50.0xad818619cd30.ImageSectionObject.rpcrt4.dll.img
ImageSectionObject      0xad818604f700  wow64.dll       file.0xad818604f700.0xad81862c0740.ImageSectionObject.wow64.dll.img
ImageSectionObject      0xad8186134700  HarddiskVolume3蕵遡驐鹇鵉顐鑕陌陇顀騻鰺鸽齃G    file.0xad8186134700.0xad818618bc70.ImageSectionObject.HarddiskVolume3蕵遡驐鹇鵉顐鑕陌陇顀騻鰺鸽齃G.img
DataSectionObject       0xad81860a4780  ntdll.dll       Error dumping file
ImageSectionObject      0xad81860a4780  ntdll.dll       file.0xad81860a4780.0xad81894692b0.ImageSectionObject.ntdll.dll.img

``` 
To use the plugin you need to supplied the PID of the program that we saw earlier in windows.pstree plugin result, this operation will dump all of related .dll and program of the malware and yes! the name will follow like the one that is output by the program.

```
~# $ file file.0xad818da36c30.0xad818ca48660.ImageSectionObject.oneetx.exe.img
file.0xad818da36c30.0xad818ca48660.ImageSectionObject.oneetx.exe.img: PE32 executable for MS Windows 4.00 (GUI), Intel i386 Mono/.Net assembly, 3 sections
```
If you check the file type the malware is written in c#. Reverse engineering c# is pretty easy compare to c++ you can used tools like dnspy or ilspy decompiler to get all the source code. Let's continue this lab by decompile the source code and see what we found

## Reverse Engineer C# program
